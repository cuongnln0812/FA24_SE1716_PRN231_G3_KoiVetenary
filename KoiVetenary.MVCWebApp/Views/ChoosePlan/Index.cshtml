@model ServiceListViewModel

@{
    ViewData["Title"] = "Index";
}
@functions {
    public string FormatCurrency(double amount)
    {
        return $"{amount:N0}đ";
    }
}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Table</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .custom-table {
            width: 100%;
            background-color: #fff;
        }

            .custom-table thead th {
                border-bottom: 2px solid #dee2e6;
                font-weight: bold;
                color: #6c757d;
                text-transform: uppercase;
            }

            .custom-table tbody td {
                vertical-align: middle;
                padding: 15px;
                color: #333;
            }

            .custom-table tbody tr:hover {
                background-color: #f8f9fa;
            }

        .rounded-circle {
            width: 40px;
            height: 40px;
            object-fit: cover;
        }

        .height {
            height: 100vh;
        }


        .search {
            position: relative;
            box-shadow: 0 0 40px rgba(51, 51, 51, .1);
        }

            .search input {
                height: 60px;
                text-indent: 25px;
                border: 2px solid #d6d4d4;
            }


                .search input:focus {
                    box-shadow: none;
                    border: 2px solid blue;
                }

            .search .fa-search {
                position: absolute;
                top: 20px;
                left: 16px;
            }

            .search button {
                position: absolute;
                top: 5px;
                right: 5px;
                height: 50px;
                width: 110px;
                background: blue;
            }

        .autocomplete-suggestions {
            border: 1px solid #d4d4d4;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            z-index: 1000;
            background-color: #fff;
        }

        .autocomplete-suggestion {
            padding: 10px;
            cursor: pointer;
        }

            .autocomplete-suggestion:hover {
                background-color: #e9e9e9;
            }

        .selected-row {
            background-color: lightblue; /* Màu nền khi hàng được chọn */
        }

        .disabled {
            background-color: grey;
            cursor: not-allowed;
        }

    </style>
</head>
<body>
    <div class="container mt-5">

                <div class="col-md-8">

                    <div class="search">
                        <i class="fa fa-search"></i>
                <form method="get" asp-action="Index">
                    <input type="text" name="searchQuery" class="form-control" placeholder="Have a question? Ask Now" value="@Context.Request.Query["searchQuery"]" id="searchQuery">
                    <button type="submit" class="btn btn-primary">Search</button>
                </form>
                <div id="autocomplete-suggestions" class="autocomplete-suggestions"></div>
            </div>

        </div>
        <table class="table table-borderless table-hover custom-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Duration</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Services)
                {
                    <tr>
                        <td><img src="@item.ServiceImg" class="rounded-circle mr-2" alt="Avatar"> @item.ServiceName</td>
                        <td>@item.Description</td>
                        <td>@item.Duration</td>
                        <td>@FormatCurrency((double)item.BasePrice)</td>
                    </tr>
                }
            </tbody>
        </table>
        <button id="nextButton" class="disabled" disabled>Next</button>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#searchQuery').on('input', function () {
                var query = $(this).val();
                if (query.length > 2) {
                    $.ajax({
                        url: 'https://localhost:7238/api/api/Services/autocomplete',
                        data: { query: query },
                        success: function (data) {
                            var suggestions = $('#autocomplete-suggestions');
                            suggestions.empty();
                            data.forEach(function (item) {
                                suggestions.append('<div class="autocomplete-suggestion">' + item.serviceName + ' - ' + item.description + ' - ' + item.categoryName + '</div>');
                            });
                            $('.autocomplete-suggestion').on('click', function () {
                                $('#searchQuery').val($(this).text());
                                suggestions.empty();
                            });
                        }
                    });
                } else {
                    $('#autocomplete-suggestions').empty();
                }
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const rows = document.querySelectorAll('tbody tr');
            const nextButton = document.getElementById('nextButton');

            rows.forEach(row => {
                row.addEventListener('click', function () {
                    // Bỏ chọn hàng khác
                    rows.forEach(r => r.classList.remove('selected-row'));

                    // Đánh dấu hàng hiện tại
                    row.classList.add('selected-row');

                    // Kích hoạt nút "Next"
                    nextButton.classList.remove('disabled');
                    nextButton.disabled = false;
                });
            });
        });
    </script>
</body>
</html>
@if (Model.TotalPages > 1)
{
    <nav>
        <ul class="pagination">
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                    <a class="page-link" asp-action="Index" asp-route-page="@i">@i</a>
                </li>
            }
        </ul>
    </nav>
}